---
import { seoNodeByURI } from '../lib/seo';

// Check if Astro.params.uri is defined and not empty
const isDefinedUri = Astro.params.uri !== undefined && Astro.params.uri !== '';

// Check if the current page is the main page
const isMainPage = Astro.request.url === '/' || Astro.request.url === 'http://localhost:4321/';

// Set the URI based on whether it's defined or not
const uri = isDefinedUri
  ? `/${Astro.params.uri}/`
  : isMainPage
    ? '/'
    : `/${Astro.request.url.split('/').filter(Boolean).pop() || ''}/`;

//console.log(uri);
//console.log(Astro.request.url);

const data = await seoNodeByURI(uri);
//console.log(data);  

const node = data.nodeByUri && data.nodeByUri.seo ? data.nodeByUri : null;

//console.log(node);

const seo = node ? node.seo : null;

//console.log(seo);
---

<meta name="description" content={seo?.metaDesc} />
<link rel="canonical" href={seo?.canonical} />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content={seo?.opengraphType} />
<meta property="og:title" content={seo?.title} />
<meta property="og:description" content={seo?.opengraphDescription} />
<meta property="og:url" content={seo?.opengraphUrl} />
<meta property="og:site_name" content={seo?.opengraphSiteName} />
<meta property="article:published_time" content={seo?.opengraphPublishedTime} />
<meta property="article:modified_time" content={seo?.opengraphModifiedTime} />
<meta property="og:image" content={seo?.opengraphImage?.sourceUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="667" />
<meta property="og:image:type" content={seo?.opengraphImage?.mimeType} />
<meta name="author" content={seo?.opengraphImage?.author?.node?.name} />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:label1" content="Written by" />
<meta name="twitter:data1" content={seo?.opengraphImage?.author?.node?.name} />
<meta name="twitter:label2" content="Est. reading time" />
<meta name="twitter:data2" content=`${seo?.readingTime} minutes` />
<script type="application/ld+json" class="yoast-schema-graph" set:html={seo?.schema.raw}>
</script>
